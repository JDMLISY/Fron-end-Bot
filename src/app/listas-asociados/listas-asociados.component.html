<div class="menu">
  <div class="example-ripple-container mat-elevation-z4 menusub" matRipple [matRippleCentered]="centered"
    [matRippleDisabled]="disabled" [matRippleUnbounded]="unbounded">
    <mat-selection-list #shoes>


      <cdk-virtual-scroll-viewport appendOnly itemSize="10" class="example-viewport">

    
        <mat-accordion multi>
          <mat-expansion-panel *ngFor="let item of typesOfShoes">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <mat-icon>folder</mat-icon> {{ item.tipo_atencion }}
                </div>
              </mat-panel-title>
              <mat-panel-description>
                <div style="width: 100%; display: flex; justify-content: flex-end;">
                  <mat-icon matTooltip="{{ item.cantidad }} solicitudes" matTooltipPosition="above">chat</mat-icon>
                </div>
              </mat-panel-description>
            </mat-expansion-panel-header>
        
            <mat-list>
              <mat-list-item *ngFor="let contacto of item.contactos"
                (click)="filtrar_solicitudes(contacto.contacto, contacto.numero, contacto.identificacion, contacto.Tipo_atencion)">
                <div matListAvatar class="avatar-inicial">
                  {{ contacto.contacto.charAt(0).toUpperCase() }}
                </div>
                <div matLine class="contacto-info">
                  <span class="contacto-nombre texto-responsive">{{ contacto.contacto }}</span>
                  <span class="badge" *ngIf="contacto.cantidad" matTooltip="{{ item.cantidad }} solicitudes"
                        matTooltipPosition="above">{{ contacto.cantidad }}</span>
                </div>
                
              </mat-list-item>
            </mat-list>
          </mat-expansion-panel>
        </mat-accordion>
        

      </cdk-virtual-scroll-viewport>
    </mat-selection-list>


  </div>





  <div *ngIf="Solicitudes" style=" width:74%;
float:right;
vertical-align:bottom;
  text-align:bottom;
margin-right: 2px;
">
    <mat-card appearance="outlined">
      <!-- <mat-card-header>
        <mat-card-title>Solicitudes del contacto: {{contacto}}</mat-card-title>
      </mat-card-header> -->
      <mat-card-header class="custom-card-header">
        <div class="avatar-inicial">
          {{ contacto.charAt(0).toUpperCase() }}
        </div>
        <div class="header-title">
          <div>Contacto: <strong>{{ contacto }}</strong></div>
          <div>Tipo de atención: <strong>{{ Tipoatencion }}</strong></div>
          <div>Radicado: <strong>{{ Radicado }}</strong></div>
        </div>
      </mat-card-header>
      

      <mat-card-content>


        <mat-form-field appearance="standard">
          
          <mat-icon matPrefix matTooltip="Buscar" matTooltipPosition="above">search</mat-icon>
          <!-- <mat-label>Buscar</mat-label> -->
          <input matInput (keyup)="applyFilter($event)" placeholder="ahorros" #input>
        </mat-form-field>




        <div class="mat-elevation-z8">
          <cdk-virtual-scroll-viewport appendOnly itemSize="10" class="example-viewport1">
            <table mat-table [dataSource]="dataSource" matSort>

              <ng-container matColumnDef="idRegistro">
                <th mat-header-cell *matHeaderCellDef mat-sort-header style="text-align:center;"> ID </th>
                <td mat-cell *matCellDef="let row" style="text-align:center;"> {{row.idRegistro}} </td>
              </ng-container>
              <ng-container matColumnDef="Tipo_atencion">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo_atencion </th>
                <td style="    text-align: left;" mat-cell *matCellDef="let row"> {{row.Tipo_atencion}} </td>
              </ng-container>

              <ng-container matColumnDef="Radicado">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Radicado </th>
                <td mat-cell *matCellDef="let row"> {{row.Radicado}} </td>
              </ng-container>

              <ng-container matColumnDef="fecha_solicitud">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> fecha_solicitud </th>
                <td mat-cell *matCellDef="let row"> {{row.fecha_solicitud}} </td>
              </ng-container>
              <ng-container matColumnDef="Contactar">
                <th mat-header-cell *matHeaderCellDef> Contactar... </th>
                <td mat-cell *matCellDef="let row; let i = index;">
                  <button mat-raised-button style="width: 130px;" class="btn btn-primary btn-block" focusable="false"
                    (click)="ver_conversacion(row.contacto,row.Numero_asociado,'S',row.Radicado)">
                    <mat-icon style="    margin-left: -11px;">smartphone</mat-icon> Contactar...
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="5">No data matching the filter "{{input.value}}"</td>
              </tr>


            </table>
          </cdk-virtual-scroll-viewport>

        </div>

      </mat-card-content>
      <mat-card-footer class="example-card-footer">
      </mat-card-footer>
    </mat-card>

  </div>




  <div *ngIf="verconversacion" style=" width:74%;
float:right;
vertical-align:bottom;
  text-align:bottom;
margin-right: 2px;
height: 550px;">

    <div class="conversacion conversacion-layout">
      <mat-card-header class="custom-card-header">
        <div class="avatar-inicial">
          {{ contacto.charAt(0).toUpperCase() }}
        </div>
        <div class="header-title">
          <div>Contacto: <strong>{{ contacto }}</strong></div>
          <div>Tipo de atención: <strong>{{ Tipoatencion }}</strong></div>
          <div>Radicado: <strong>{{ Radicado }}</strong></div>
        </div>
      </mat-card-header>

      <mat-card class="conversacion" appearance="outlined">

        <div class="conversacion-body">
          <div class="botones-columna">
            <!-- <div style="width: 45%;
    float: left;
    vertical-align: bottom;
    text-align: bottom;
    margin-right: auto;   
    height: 415px;
    margin-top: 31px;">
              <div (click)="openDialog()" style="    margin: 10px;
    border: groove; border-radius: 20px;  background-color: #82c7e6;     width: 200%; ">
                <span><i class="material-icons">precision_manufacturing</i>Gestionar Solicitudes</span>

              </div>
              <div (click)="traer_archivo('Solicitudes')" style="    margin: 10px;
    border: groove; border-radius: 20px;  background-color: #82c7e6;     width: 200%; ">
                <i class="material-icons">view_list</i>
                <span>Imprimir Solicitudes</span>

              </div>
              <div (click)="traer_archivo('Conversacion')" style="    margin: 10px;
    border: groove; border-radius: 20px;  background-color: #82c7e6;     width: 200%; ">
                <i class="material-icons">chat</i>
                <span> Imprimir Conversaciòn</span>

              </div>

              <div (click)="traer_archivo('Conversacion')" style="    margin: 10px;
              border: groove; border-radius: 20px;  background-color: #82c7e6;     width: 200%; ">
                          <i class="material-icons">chat</i>
                          <span>Trasladar Conversación</span>
          
                        </div>


                        <div class="boton-opcion" (click)="traer_archivo('Conversacion')">
                          <i class="material-icons">chat</i>
                          <span>Trasladar Conversación</span>
                        </div>


            </div> -->

            <div class="boton-container">
              <div class="boton-opcion" (click)="openDialog()">
                <i class="material-icons">build</i>
                <span>Gestionar Solicitudes</span>
              </div>
            
              <div class="boton-opcion" (click)="traer_archivo('Solicitudes')">
                <i class="material-icons">description</i>
                <span>Imprimir Solicitudes</span>
              </div>
            
              <div class="boton-opcion" (click)="traer_archivo('Conversacion')">
                <i class="material-icons">chat</i>
                <span>Imprimir Conversación</span>
              </div>
            
              <div class="boton-opcion" (click)="consultarusers()">
                <i class="material-icons">sync_alt</i>
                <span>Trasladar Conversación</span>
              </div>
            </div>
            

          </div>

           <!-- <div class="chat-area">
            <div class="phone-frame">
              <mat-card-content class="mat-card-content1">
                <mat-selection-list #Conver [(ngModel)]="Conversa">
                  <div #container class="container">
                    <ul>
                      <li *ngFor="let Conver of Conversa" class="divconversa">

                        <div *ngIf="Conver.dedonde=='BOT'" class="message message-bot">
                          {{Conver.Mensaje}}
                        </div>

                        <div *ngIf="Conver.dedonde=='WEB' && Conver.Ruta_Archivo == 'N'" class="message message-web">
                          {{Conver.Mensaje}}
                        </div>

                        <div *ngIf="Conver.dedonde=='WEB' && Conver.Ruta_Archivo == 'S'" class="message message-web">
                          <iframe *ngIf="Conver.tipoarchivo=='application/pdf'" [src]="Conver.Mensaje" height="200"
                            width="100%" (click)="downloadFile(Conver.Mensaje)"></iframe>
                          <img *ngIf="Conver.tipoarchivo?.startsWith('image/')" style="height:200px"
                            [src]="Conver.Mensaje" width="100%" alt="" (click)="downloadFile(Conver.Mensaje)">
                          <iframe *ngIf="Conver.tipoarchivo=='otro'" [src]="Conver.Mensaje" width="100%"
                            height="600px"></iframe>
                        </div>

                        <div *ngIf="Conver.dedonde=='ASO' && Conver.Ruta_Archivo == 'N'" class="message message-aso">
                          {{Conver.Mensaje}}
                        </div>

                        <div *ngIf="Conver.dedonde=='ASO' && Conver.Ruta_Archivo == 'S'" class="message message-aso">
                          <img style="height:200px" [src]="Conver.Mensaje" alt=""
                            (click)="downloadFile(Conver.Mensaje)">
                        </div>

                      </li>
                    </ul>
                  </div>
                </mat-selection-list>

                <div class="input-area" style="position: relative; display: flex; align-items: center;">
                  <input matInput (keyup.enter)="enviar(numero)" type="text" [(ngModel)]="texto"
                    placeholder="Escribe tu mensaje..." style="flex: 1;" />

                  <button mat-icon-button (click)="fileInput.click()" aria-label="Adjuntar archivo">
                    <mat-icon>attach_file</mat-icon>
                  </button>
                  <input type="file" #fileInput id="fileInput" (change)="selectFile($event)" style="display: none;" />

                  <button mat-icon-button (click)="toggleSelector()" aria-label="Mostrar emojis">
                    <mat-icon>emoji_emotions</mat-icon>
                  </button>

                  <button mat-icon-button color="primary" (click)="enviar(numero)" aria-label="Enviar mensaje">
                    <mat-icon>send</mat-icon>
                  </button>

                  <div *ngIf="mostrarSelector" #emojiPicker class="emoji-picker-container">
                    <emoji-mart (emojiSelect)="agregarEmoji($event)"></emoji-mart>
                  </div>
                </div>


              </mat-card-content>
            </div>


            <mat-card-footer class="example-card-footer">

            </mat-card-footer>
          </div>  -->

          <div class="chat-area">
            <div class="phone-frame">
              <!-- Botón en la parte superior del marco del celular -->


              <mat-card-content class="mat-card-content1">
                <mat-selection-list #Conver [(ngModel)]="Conversa">
                  <div #container class="container">
                    <ul>
                      <li *ngFor="let Conver of Conversa" class="divconversa">
          
                        <!-- Separador de fecha -->
                        <div *ngIf="Conver.tipo === 'separador'" class="date-separator">
                          <span class="date-label">{{ Conver.fecha }}</span>
                        </div>
          
                        <!-- Mensaje de BOT -->
                        <div *ngIf="Conver.dedonde=='BOT'" class="message message-bot">
                          {{Conver.Mensaje}}
                        </div>
          
                        <!-- Mensaje de WEB sin archivo -->
                        <div *ngIf="Conver.dedonde=='WEB' && Conver.Ruta_Archivo == 'N'" class="message message-web">
                          {{Conver.Mensaje}}
                        </div>
          
                        <!-- Mensaje de WEB con archivo -->
                        <div *ngIf="Conver.dedonde=='WEB' && Conver.Ruta_Archivo == 'S'" class="message message-web">
                          <iframe *ngIf="Conver.tipoarchivo=='application/pdf'" [src]="Conver.Mensaje" height="200"
                                  width="100%" (click)="downloadFile(Conver.Mensaje)"></iframe>
                          <img *ngIf="Conver.tipoarchivo?.startsWith('image/')" style="height:200px"
                               [src]="Conver.Mensaje" width="100%" alt="" (click)="downloadFile(Conver.Mensaje)">
                          <iframe *ngIf="Conver.tipoarchivo=='otro'" [src]="Conver.Mensaje" width="100%"
                                  height="600px"></iframe>
                        </div>
          
                        <!-- Mensaje de ASO sin archivo -->
                        <div *ngIf="Conver.dedonde=='ASO' && Conver.Ruta_Archivo == 'N'" class="message message-aso">
                          {{Conver.Mensaje}}
                        </div>
          
                        <!-- Mensaje de ASO con archivo -->
                        <div *ngIf="Conver.dedonde=='ASO' && Conver.Ruta_Archivo == 'S'" class="message message-aso">
                          <img style="height:200px" [src]="Conver.Mensaje" alt=""
                               (click)="downloadFile(Conver.Mensaje)">
                        </div>
          
                      </li>
                    </ul>
                  </div>
                </mat-selection-list>
          
                <!-- Área de entrada -->
                <div class="input-area" style="position: relative; display: flex; align-items: center;">
                  <input matInput (keyup.enter)="enviar(numero)" type="text" [(ngModel)]="texto"
                         placeholder="Escribe tu mensaje..." style="flex: 1;" />
          
                  <button mat-icon-button (click)="fileInput.click()" aria-label="Adjuntar archivo">
                    <mat-icon>attach_file</mat-icon>
                  </button>
                  <input
                  type="file"
                  #fileInput
                  id="fileInput"
                  (change)="selectFile($event)"
                  accept=".pdf,image/*"
                  style="display: none;"
                />
                 
                  <button mat-icon-button (click)="toggleSelector()" aria-label="Mostrar emojis">
                    <mat-icon>emoji_emotions</mat-icon>
                  </button>
          
                  <button mat-icon-button color="primary" (click)="enviar(numero)" aria-label="Enviar mensaje">
                    <mat-icon>send</mat-icon>
                  </button>
          
                  <div *ngIf="mostrarSelector" #emojiPicker class="emoji-picker-container">
                    <emoji-mart (emojiSelect)="agregarEmoji($event)"></emoji-mart>
                  </div>
                </div>
              </mat-card-content>
              <mat-card-footer class="footer-boton-cel">
                <button mat-raised-button color="primary" class="boton-cerrar-conversacion" (click)="cerrarconversacion()">
                  <mat-icon>close</mat-icon>
                  <span>Cerrar conversación</span>
                </button>
              </mat-card-footer>
          
              
            </div>
          </div>
          


        </div>
      </mat-card>

    </div>


  </div>
</div>